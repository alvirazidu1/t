(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9224],{63708:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/d/[namespace]/[collection]/import",function(){return t(53050)}])},65548:function(e,n,t){"use strict";t.d(n,{c:function(){return c}});var r=t(7297),i=t(93391);function o(){var e=(0,r.Z)(["\n    from {\n        transform: rotate(0deg);\n    }\n    to {\n        transform: rotate(360deg);\n    }\n"]);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n    width: ",";\n    height: ",";\n    box-sizing: border-box;\n    border: 2px solid;\n    border-radius: 100%;\n    border-color: #e0e0e0;\n    border-right-color: #616161;\n    animation: "," 1s linear infinite;\n"]);return a=function(){return e},e}var s=(0,i.F4)(o()),c=(0,i.ZP)("div")(a(),(function(e){return e.size?"".concat(e.size,"px"):"12px"}),(function(e){return e.size?"".concat(e.size,"px"):"12px"}),s)},53050:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Xe}});var r=t(85893),i=t(67294),o=t(11163),a=t(46670),s=t(91237),c=t(30085),l=t(47568),u=t(14924),d=t(26042),m=t(69396),p=t(828),f=t(7297),h=t(29815),x=t(20414),g=t(68949),v=t(93391);var j=t(96890),y=t(83192),b=t(42146),N=t(33085),w=t(64487),S=t(57460),C=t.n(S),E=t(34959),P=t(86893),k=t(6729),I=t.n(k),T=t(16170),R=t(28941),Z=t(34705),L=t(14508),O=t(41664),M=t.n(O),D=t(70475);function z(e){var n=e.numberItems,t=e.maximumImportLimit,i=e.maximumParsingReached,o=e.maxItemsParse,a=e.enableFiltering,s=e.isAnonymousUser,c=e.isFreeUser;return(0,r.jsx)(D.Z,{children:s?(0,r.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,r.jsx)(P.BJv,{size:32}),(0,r.jsxs)("div",{className:"text pl-4",children:[(0,r.jsxs)("strong",{children:["CSV import is limited to ",t," items for anonymous users."]}),(0,r.jsx)("br",{}),"Only the first ",t," will be imported.\xa0",(0,r.jsx)("strong",{children:(0,r.jsx)(M(),{href:"/auth/signup",children:(0,r.jsx)("a",{children:"Sign up for free"})})})," to import bigger files!"]}),(0,r.jsx)("div",{children:(0,r.jsx)(M(),{href:"/auth/signup",children:(0,r.jsx)("a",{className:"btn btn-secondary",children:"Sign up for free!"})})})]}):(0,r.jsx)("div",{children:c?(0,r.jsxs)("div",{children:[(0,r.jsxs)("strong",{children:["Free users can import up to ",t," items!"]}),(0,r.jsxs)("p",{children:[i?"More than ".concat(o):n," items were found in your CSV file."]}),a&&(0,r.jsxs)("p",{children:["Please use the ",(0,r.jsx)("strong",{children:"filters in the preview step later"})," to filter out items.  Without filters, ",(0,r.jsxs)("strong",{children:["only the first ",t," items will be imported."]})]}),(0,r.jsx)("p",{children:(0,r.jsxs)("strong",{children:["Note: Premium users can import files with up to ","2000000"," rows.\xa0",(0,r.jsx)(M(),{href:"/account/upgrade",children:(0,r.jsx)("a",{onClick:function(){T.B({category:"Convert",action:"Restricted",label:"ImportLimit"})},children:"Upgrade \ud83d\ude80"})})]})})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("strong",{children:["CSV import is limited to ",t," items!"]}),(0,r.jsxs)("p",{children:[i?"More than ".concat(o):n," items were found in your CSV file."]}),a&&(0,r.jsxs)("p",{children:["Please use the ",(0,r.jsx)("strong",{children:"filters in the preview step later"})," to filter out items.  Without filters, ",(0,r.jsxs)("strong",{children:["only the first ",t," items will be imported."]})]})]})})})}function _(){var e=(0,f.Z)(["\n    font-weight: bold;\n    margin-bottom: 16px;\n"]);return _=function(){return e},e}function F(){var e=(0,f.Z)(["\n    padding: 4px 8px;\n    display: inline-block;\n    background: #540B0E99;\n    color: #FFF;\n    border-radius: 4px;\n    margin: 4px;\n    font-size: 14px;\n"]);return F=function(){return e},e}var A=v.ZP.div(_()),U=v.ZP.div(F());function B(e){var n=e.delimiter,t=e.onDelimiterChange,i=e.headers,o=e.encoding,a=e.detectedEncodings,s=e.onEncodingChange,c=i.slice(0,8),l=i.length>8;return(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"d-flex justify-content-center mt-2",children:[a.length>0&&(0,r.jsx)("div",{className:"pr-3",children:(0,r.jsx)(R.lq,{id:"file-encoding",value:o||"",name:"file-encoding",onChange:function(e){var n=e.target.value;s(n)},label:"Encoding",style:{width:200},children:a.map((function(e){return(0,r.jsxs)("option",{value:e.name,children:[e.name," ",e.lang&&(0,r.jsxs)(r.Fragment,{children:["(Language: ",e.lang,")"]})]},e.name)}))})}),n&&n.length>0&&(0,r.jsx)("div",{className:"",children:(0,r.jsxs)(R.lq,{id:"file-delimiter",value:n,name:"file-delimiter",onChange:function(e){var n=e.target.value;t(n)},label:"Delimiter",style:{width:200},children:[(0,r.jsx)("option",{value:",",children:"Comma (,)"}),(0,r.jsx)("option",{value:";",children:"Semicolon (;)"}),(0,r.jsx)("option",{value:"\\t",children:"Tab"}),(0,r.jsx)("option",{value:"|",children:"Pipe (|)"})]})})]}),(0,r.jsx)("div",{className:"d-md-flex justify-content-center mt-2",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)(A,{className:"text",children:["Your file is valid! Here is a preview of the ",i.length," headers we found in it. For a file without named headers, please change the options before loading it. If the headers look good, continue to the properties step.",a.length>0&&(0,r.jsx)("span",{children:"\xa0If some characters look weird, try changing the encoding."})]}),c.map((function(e){return(0,r.jsx)(U,{children:e.name},e.id)})),l&&(0,r.jsx)("span",{children:"..."})]})})]})}function q(){var e=(0,f.Z)(["\n    padding: 16px;\n    border-radius: 8px;\n    font-weight: bold;\n    background-color: #FBE6E5;\n    color: #BD433E;\n"]);return q=function(){return e},e}var J=v.ZP.div(q());function W(e){var n=e.messages;return(0,r.jsx)(J,{className:"text-center mt-6",children:n?(0,r.jsx)("div",{children:n.map((function(e){return(0,r.jsx)("div",{children:e},e.substring(0,100))}))}):(0,r.jsx)("div",{children:"No items found in file. Please try another file."})})}var V=t(21876).Buffer;function H(){var e=(0,f.Z)(["\n    margin-top: 24px;\n    text-align: center;\n\n    .number {\n        font-size: 2.5em;\n    }\n"]);return H=function(){return e},e}function G(){var e=(0,f.Z)(["\n    max-width: 700px;\n    margin: 0 auto;\n\n    .upload-area {\n        align-items: center;\n        border-style: dashed;\n        border-width: 2px;\n        border-radius: 8px;\n        border-color: rgb(133, 138, 153);\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        justify-content: center;\n        padding: 20px;\n        background-color: rgb(244, 247, 246);\n        min-height: 400px;\n        cursor: pointer;\n        position: relative;\n    }\n\n    .remove-icon {\n        position: absolute;\n        right: 8px;\n        top: 8px;\n    }\n\n    .drop-zone-text {\n        color: #858A99;\n    }\n"]);return G=function(){return e},e}var K=v.ZP.div(H()),Q=v.ZP.div(G()),$=5242880,X=["xlsx","xls","xlsm","xlsb","ods"],Y=[".tsv",".txt","text/csv, .csv, application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",X.map((function(e){return".".concat(e)})).join(", ")].join(", "),ee="Your file seems empty. Please send us a message (contact@datablist.com) to help you import your file.",ne=(0,i.forwardRef)((function(e,n){var t,o=e.collection,a=e.headers,c=e.numberItems,l=e.encoding,u=e.delimiter,d=e.maxImportNumber,m=e.onSetHeaders,p=e.onSetCsvData,f=e.onContinueToMapping,x=e.onSetFileName,g=e.onIncrementNumberItems,v=e.onSetEncoding,y=e.onSetDelimiter,b=e.onSetSkipFirstNLines,S=function(e){var n=[],t=e.filter((function(e){return e})).map((function(e){var t=String(e).trim();0===t.length&&(t="No Name");for(var r=(0,Z.hs)(t),i=0;i<5&&-1!==n.indexOf(r);)r+=(0,L.X)(0,100),i++;return new N.iE({id:r,name:t})}));return m(t),Ze.current=t,t},k=function(e,n){O(e,n,1e4)},O=function(e,n,t){var r=e.data,i=e.meta,a=e.errors;if(i&&(null===i||void 0===i?void 0:i.delimiter)&&!be.current&&(be.current=i.delimiter,y(i.delimiter)),a.length>0){for(var s=[],c=0;c<a.length;c++){var l=a[0];if(!l.message||-1===l.message.indexOf("Unable to auto-detect delimiting character")||"undefined"===typeof r[0]||!Array.isArray(r[0])||1!==r[0].length){var u="Error";"undefined"!==typeof l.row&&(u+=" on line ".concat(l.row)),l.index&&(u+=", on character ".concat(l.index)),l.message&&(u+=": ".concat(l.message)),s.push(u)}}s.length>0&&fe((function(e){return(0,h.Z)(e).concat((0,h.Z)(s))})),T.B({category:"Error",action:"ImportError",label:"ParsingError",value:r.length,data:{collectionId:o.id,fileName:ce.current,firstItem:JSON.stringify(r.length>0?r[0]:{}),errorMsg:s.join("-")}})}if(!Re.current){(0,j.cM)("Build Headers");var m=r[0];if("undefined"===typeof m)return fe((function(e){return(0,h.Z)(e).concat([ee])})),ne(!0),w.Tb(new Error("Empty csv file"),{extra:{chunckLength:r.length,fileName:ce.current,fileSize:ue}}),void T.B({category:"Error",action:"ImportError",label:"EmptyCSV",value:r.length,data:{collectionId:o.id,chunckLength:r.length,firstItem:JSON.stringify(m),secondItem:JSON.stringify(r[1]),thirdItem:JSON.stringify(r[2])}});var f=[];if(i.fields)(0,j.cM)("Use Fields data"),f=S(i.fields);else if(je){if(b(1),!Array.isArray(r[0]))throw new Error("Invalid Data");for(var x=r.shift(),v={},C=[],E=0;E<x.length;E++){var P=x[E];0===P.trim().length&&(P="No Name");var k=v[P]||0;k>0?C.push("".concat(P,"_").concat(k)):C.push(P),v[P]=k+1}f=S(C)}else{if(!Array.isArray(m))throw new Error("Invalid Data");for(var I=m.length,R=[],Z=0;Z<I;Z++)R.push("Column".concat(Z+1));f=S(R)}Re.current=!0,T.B({category:"Data",action:"Import",label:"SetHeaders",value:f.length,data:{collectionId:o.id,fileName:ce.current,headers:f.map((function(e){return e.name})).join(";")}})}if(0!=r.length){var L=[];if(Array.isArray(r[0])){if(!Ze.current||0===Ze.current.length)return void fe((function(e){return(0,h.Z)(e).concat(["Invalid Headers"])}));r.forEach((function(e){var n={};e.forEach((function(e,t){var r=Ze.current[t];r&&(n[r.name]=e)})),L.push({data:n,errors:[]})}))}else r.forEach((function(e){L.push({data:e,errors:[]})}));Te.current<d&&(!t||Te.current<t)&&p((function(e){return(0,h.Z)(e).concat((0,h.Z)(L)).slice(0,d)})),g(r.length),ne(!0),Te.current>d&&(Oe.current||T.B({category:"Data",action:"Import",label:"ImportLimitReached",value:Te.current,data:{collectionId:o.id,format:"CSV",numberItems:Te.current,fileName:ce.current,fileSize:ue}}),Pe(!0)),Te.current>=N.WJ&&(Se(!0),n.abort(),T.B({category:"Data",action:"Import",label:"ParsingLimitReached",value:Te.current,data:{collectionId:o.id,format:"CSV",numberItems:Te.current,fileName:ce.current,fileSize:ue}}))}else ne(!0)},M=function(e,n,t){Le.current=e;var r={skipEmptyLines:"greedy",encoding:n,delimiter:t||u,chunkSize:$,chunk:k,worker:!0};C().parse(e,r)},D=function(e,n){var t;try{t=function(e){var n=1024,t=1048576,r=1073741824;if(e<t){var i=Number((e/n).toFixed(0));return i<=0?e+" B":i+" KB"}return e<r?(e/t).toFixed(0)+" MB":e<1099511627776?(e/r).toFixed(0)+" GB":""}(e.size)}catch(u){return window.alert("Cannot read file. Please contact support@datablist.com so we can fix this."),void w.Tb(u,{extra:{file:e,source:n}})}fe([]),se(e.name),x(e.name),de(t);var r,i=e.name.split(".").pop();if(-1!==X.indexOf(i.toLowerCase()))!function(e){Le.current=null;var n=new FileReader;n.onload=function(n){var t;try{t=(0,E.ij)(n.target.result,{type:"binary",cellDates:!0})}catch(u){return fe((function(n){return(0,h.Z)(n).concat([String(u)])})),void ne(!0)}var r,i=t.SheetNames[0],a=t.Sheets[i],s=E.P6.sheet_to_json(a,{header:1,blankrows:!1,dateNF:"yyyy-mm-dd"});if(0===s.length)return fe((function(e){return(0,h.Z)(e).concat([ee])})),ne(!0),void w.Tb(new Error("Empty excel file"),{extra:{fileName:e.name,fileSize:ue}});if(je)r=s.shift();else{r=[];for(var c=0;c<s[0].length;c++)r.push("Column".concat(c+1))}for(var l=S(r),m=[],f=0;f<s.length;f++){for(var x=s[f],v={},j=0;j<l.length;j++){var y=l[j].name,b=x[j];v[y]=null==b?"":x[j]}m.push({data:v,errors:[]})}p((function(e){return(0,h.Z)(e).concat((0,h.Z)(m)).slice(0,d)})),m.length>d&&Pe(!0),g(s.length),ne(!0),T.B({category:"Data",action:"Import",label:"SetHeaders",value:r.length,data:{collectionId:o.id,fileName:e.name,headers:l.map((function(e){return e.name})).join(";")}})},n.readAsArrayBuffer(e)}(e),r="excel";else{r="csv";var a=1048576,s=e.size>a;(0,j.cM)("Is partial load",s);var c=new FileReader;c.onload=function(n){var t,r=n.target.result.toString(),i=r.slice(0,24e3),a=I().analyse(V.from(i));ge(a),a.length>0&&(t=a[0].name,v(t)),i.split(/\r\n|\r|\n/).length<=1?s||(Le.current=null,function(e,n){var t;!function(e){e.COMMA="comma",e.SEMICOLON="semicolon"}(t||(t={}));var r=t.COMMA,i=e.split(",").length,a=e.split(";").length;if(a>i&&(r=t.SEMICOLON,i=a),i<=5)return fe((function(e){return(0,h.Z)(e).concat([ee])})),ne(!0),void w.Tb(new Error("Empty csv file from convert"),{extra:{fileName:ae,fileSize:ue}});var s,c="NoName";r===t.COMMA?s=e.split(","):r===t.SEMICOLON&&(s=e.split(";"));for(var l=0;l<s.length;l++)c+="\n".concat(s[l].trim());var u={skipEmptyLines:"greedy",header:!0,encoding:n,chunkSize:$,chunk:O,worker:!0};C().parse(c,u),T.B({category:"Data",action:"Import",label:"ConvertTxt",data:{collectionId:o.id,splitter:r,fileName:ae,fileSize:ue}})}(r,t)):M(e,t)};var l=e.slice(0,a);c.readAsBinaryString(l)}T.B({category:"Data",action:"Import",label:"FileLoad",value:e.size,data:{collectionId:o.id,format:r,fileName:e.name,fileExtention:i,fileSize:t,firstRowWithHeaders:je}})},_=function(e){e.preventDefault(),e.stopPropagation(),Ie.current.style.borderWidth="5px"},F=function(){Ie.current.style.borderWidth="2px"},A=function(){Se(!1),Pe(!1),ne(!1),fe([]),m([]),p([]),g(null)},U=(0,i.useState)(!1),q=U[0],J=U[1],H=(0,i.useState)(!1),G=H[0],ne=H[1],te=(0,i.useState)(!1),re=te[0],ie=te[1],oe=(0,i.useState)(null),ae=oe[0],se=oe[1],ce=(0,i.useRef)(null);ce.current=ae;var le=(0,i.useState)(null),ue=le[0],de=le[1],me=(0,i.useState)([]),pe=me[0],fe=me[1],he=(0,i.useState)([]),xe=he[0],ge=he[1],ve=(0,i.useState)(!0),je=ve[0],ye=ve[1],be=(0,i.useRef)(null);be.current=u;var Ne=(0,i.useState)(!1),we=Ne[0],Se=Ne[1],Ce=(0,i.useState)(!1),Ee=Ce[0],Pe=Ce[1],ke=(0,i.useRef)(null),Ie=(0,i.useRef)(null),Te=(0,i.useRef)(0),Re=(0,i.useRef)(!1),Ze=(0,i.useRef)(null),Le=(0,i.useRef)(null),Oe=(0,i.useRef)(null);Oe.current=Ee,(0,i.useImperativeHandle)(n,(function(){return Le.current})),Re.current=0!==a.length,Ze.current=a;var Me=(0,s.QT)().authStore;(0,i.useEffect)((function(){var e=document.createElement("div");"FileReader"in window&&"ondrop"in e||ie(!0)}),[]),Te.current=c;var De="number"===typeof c&&c>0?150:400;return(0,r.jsxs)(Q,{children:[re?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{children:"Unsupported Browser"}),(0,r.jsx)("div",{children:"Please use a modern web browser like Chrome or Firefox"})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"file",ref:ke,accept:Y,onChange:function(e){var n;(n=e.target.files[0])&&D(n,"handleFileChange")},style:{display:"none"}}),(0,r.jsx)("div",{className:"upload-area",style:{minHeight:"".concat(De,"px")},ref:Ie,onDrop:function(e){if(e.preventDefault(),e.stopPropagation(),F(),!G){var n=e.dataTransfer.files;n&&D(n[0],"handleFileDrop")}},onDragOver:_,onDragEnter:_,onDragLeave:F,onClick:function(e){e.preventDefault(),e.stopPropagation(),G?(Se(!1),Pe(!1),ne(!1),se(null),de(null),fe([]),m([]),p([]),x(null),v(null),y(""),Le.current=null,g(null)):(ke.current.value=null,ke.current.click())},children:ae&&ue?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"remove-icon",children:(0,r.jsx)(P.q5L,{size:16})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("div",{className:"file-size",children:[(0,r.jsx)("span",{className:"text-bold",children:ue})," - ",ae]})}),(0,r.jsx)("div",{className:"d-flex justify-content-center",children:(0,r.jsxs)(K,{children:[(0,r.jsx)("div",{className:"number",children:we?"".concat(N.WJ,"+"):c}),(0,r.jsx)("div",{className:"text",children:"Items found"})]})})]}):(0,r.jsxs)("div",{className:"text-center drop-zone-text",children:[(0,r.jsx)(P.Re4,{size:64,color:"#858A99"}),(0,r.jsx)("div",{className:"mt-4",children:"Drop a CSV or Excel file to upload or click here to choose file"}),(0,r.jsx)("div",{className:"mt-2 text text-bold",children:je?(0,r.jsx)("span",{children:'The column headers must be in the first row. See "More options" to change this setting.'}):(0,r.jsx)("span",{children:'Headers (Column1, Column2, etc.) will be auto-generated for each column. See "More options" to change this setting'})})]})})]}),"number"===typeof c&&c>=1&&(0,r.jsx)(B,{encoding:l,detectedEncodings:xe,onEncodingChange:function(e){v(e),A(),M(Le.current,e)},headers:a,delimiter:u,onDelimiterChange:function(e){y(e),A(),M(Le.current,l,e)}}),Ee&&(0,r.jsx)(z,{numberItems:c,maxItemsParse:N.WJ,maximumImportLimit:d,maximumParsingReached:we,isAnonymousUser:Me.isAnonymousUser,isFreeUser:Me.isReady&&(null===(t=Me.currentAccount)||void 0===t?void 0:t.freePlan),enableFiltering:Le&&!!(null===Le||void 0===Le?void 0:Le.current)}),"number"===typeof c&&c>=1&&(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)("button",{className:"btn btn-primary",onClick:function(){f(Ee&&Me.isAnonymousUser)},children:[(0,r.jsx)("span",{children:"Continue to properties"}),(0,r.jsx)(P.Rgz,{size:16})]})})}),!G&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"d-flex justify-content-center align-items-center",onClick:function(){J(!q)},children:[(0,r.jsx)("div",{className:"d-flex align-items-center",children:q?(0,r.jsx)(P.bTu,{size:16}):(0,r.jsx)(P.Tfp,{size:16})}),(0,r.jsx)("div",{className:"fake-link",children:"More options"})]}),q&&(0,r.jsx)("div",{className:"d-flex justify-content-center",children:(0,r.jsx)(R.I0,{checked:!je,onChange:function(e){ye(!e.currentTarget.checked)},id:"confirm-delete-collection",name:"confirm-delete-collection",label:"Auto-generate headers",helpText:"Check this option if the first row in your file doesn't contain headers."})})]}),0===pe.length&&G&&"number"===typeof c&&0==c&&(0,r.jsx)(W,{}),pe.length>0&&(0,r.jsx)(W,{messages:pe})]})})),te=(0,a.Pi)(ne),re=t(87789),ie=t(87423),oe=t(89742),ae=t(41844),se=t(97324),ce=t(5213),le=t(70935);function ue(e){var n,t=e.tooltipLabel,i=e.primitiveDataType,o=e.onClick,a=i;switch(i){case le.k.Date:case le.k.DateTime:n=(0,r.jsx)(P.vlc,{size:16});break;case le.k.Boolean:a="Checkbox",n=(0,r.jsx)(P.LSm,{size:16});break;case le.k.Email:n=(0,r.jsx)(P.BQk,{size:16});break;case le.k.Url:n=(0,r.jsx)(P.dyY,{size:16});break;case le.k.Number:n=(0,r.jsx)(P.JnT,{size:16});break;case le.k.LongText:a="Long Text",n=(0,r.jsx)(P.RUS,{size:16});break;case le.k.Text:n=(0,r.jsx)(P.jut,{size:16})}return(0,r.jsx)(ie.u,{content:t,children:(0,r.jsxs)("button",{className:"btn btn-input",disabled:!o,type:"button",onClick:o,children:[(0,r.jsx)("span",{children:a}),n]})})}function de(e){var n=e.detectedType,t=e.dataType,i=e.onClick,o="Text"!==t&&n!==t&&function(e){return-1!==[le.k.DateTime,le.k.Boolean,le.k.Number].indexOf(e)}(t);return(0,r.jsxs)("div",{className:"d-flex align-items-center",children:[(0,r.jsx)(ue,{primitiveDataType:t,tooltipLabel:"Edit column",onClick:i}),o&&(0,r.jsx)(ie.u,{content:"Datablist detects ".concat(n," values. Please use the Clean->Convert assistant after import if you want to convert data to avoid error."),children:(0,r.jsx)("div",{className:"ml-2 pr-2",children:(0,r.jsx)(P.BJv,{size:16,color:"orange"})})})]})}function me(e){var n=e.header,t=e.mapping;return(0,r.jsxs)("div",{className:"d-flex align-items-center",children:[n.name.toLowerCase()===t.name.toLowerCase()?(0,r.jsx)("span",{children:t.name}):(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{style:{textDecorationLine:"line-through",fontWeight:"initial"},children:n.name})," \u279e ",t.name]}),t.unique&&(0,r.jsx)("div",{className:"ml-2",children:(0,r.jsx)(ie.u,{content:"Unique values",children:(0,r.jsx)("span",{children:(0,r.jsx)(P.o1l,{size:16})})})})]})}var pe=t(88854),fe=t(72130);function he(e){var n=e.mapping,t=e.onChange,o=function(){a.modal.close()},a=(0,s.QT)().uiStore,c=(0,i.useState)(null),l=c[0],u=c[1];return(0,i.useEffect)((function(){u(n)}),[n]),l?(0,r.jsx)("div",{children:(0,r.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(l),o()},children:[(0,r.jsx)(R.oi,{autoComplete:"off",id:"property_name",name:"property_name",value:l.name,onChange:function(e){var n=(0,m.Z)((0,d.Z)({},l),{name:e.currentTarget.value});u(n)},label:"Property Name",required:!0}),(0,r.jsx)(R.lq,{value:l.dataType,onChange:function(e){var n=(0,m.Z)((0,d.Z)({},l),{dataType:e.currentTarget.value});u(n)},label:"Property Type",id:"property_type",children:pe.C.map((function(e){return(0,r.jsx)("option",{value:e.id,children:e.name},e.id)}))}),(0,r.jsx)(fe.Z,{checked:l.unique,onChange:function(e){var n=(0,m.Z)((0,d.Z)({},l),{unique:e.currentTarget.checked});u(n)}}),(0,r.jsxs)("div",{className:"form-actions d-flex justify-content-between mt-5",children:[(0,r.jsx)("div",{className:"btn btn-secondary",onClick:o,children:"Close"}),(0,r.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Save Property"})]})]})}):null}function xe(){var e=(0,f.Z)(["\n    height: 50px;\n    max-width: 500px;\n    width: 100%;\n    user-select: none;\n\n    .data-type {\n        width: 128px;\n    }\n\n    .toggle {\n        width: 96px;\n        cursor: pointer;\n\n        .toggle-icon {\n            width: auto;\n            padding-right: 16px;\n        }\n    }\n"]);return xe=function(){return e},e}var ge=v.ZP.div(xe());function ve(e){var n=e.header,t=e.itemsPreviews,o=e.mapping,a=e.onChangeMapping,c=function(e){a(n.id,e)},l=function(){u.modal.show((0,r.jsx)(ce.Z,{title:"Edit property",hideActions:!0,content:(0,r.jsx)(he,{mapping:o,onChange:c})}))},u=(0,s.QT)().uiStore,p=(0,i.useState)(null),f=p[0],h=p[1];return(0,i.useEffect)((function(){var e=t.map((function(e){return e.data[n.name]})),r=(0,se.kn)(e);h(r);var i=n.name;i&&0!==i.length||(i="(No Name)");var o={name:i,dataType:r,import:!0,unique:!1,withIndex:!1};a(n.id,o)}),[n.id]),o?(0,r.jsxs)(ge,{className:"d-flex justify-content-end align-items-center",children:[(0,r.jsx)("div",{className:"cursor-pointer text-bold pr-3 flex-grow-1",onClick:l,children:(0,r.jsx)(me,{mapping:o,header:n})}),(0,r.jsx)("div",{className:"data-type d-flex flex-grow-0 flex-shrink-0 justify-content-end",children:(0,r.jsx)(de,{dataType:o.dataType,detectedType:f,onClick:l})}),!1,(0,r.jsx)("div",{onClick:function(){var e=(0,m.Z)((0,d.Z)({},o),{import:!o.import});a(n.id,e)},className:"flex-grow-0 flex-shrink-0 toggle d-flex align-items-center justify-content-end",children:o.import?(0,r.jsx)("div",{className:"toggle-icon toggle-enabled",children:(0,r.jsx)(P.X$5,{size:20})}):(0,r.jsx)("div",{className:"toggle-icon toggle-disabled",children:(0,r.jsx)(P.gU9,{size:20})})})]}):null}var je=t(93682);function ye(){var e=(0,f.Z)(["\n    max-width: 700px;\n    margin: 0 auto;\n\n    .listing-headers {\n        max-width: 500px;\n        width: 100%;\n        margin-top: 40px;\n        margin-bottom: 10px;\n        margin-left: auto;\n        margin-right: auto;\n        color: #00000080;\n    }\n"]);return ye=function(){return e},e}var be=v.ZP.div(ye());function Ne(e){var n=e.collection,t=e.headers,o=e.itemsPreviews,a=(e.mappingSettings,e.onChange),s=e.onError,c=e.onContinueToImport,f=function(e,n){b((function(t){return(0,m.Z)((0,d.Z)({},t),(0,u.Z)({},e,n))}))},h=(0,i.useState)(!1),g=h[0],v=h[1],j=(0,i.useState)({}),y=j[0],b=j[1];function N(){return(N=(0,l.Z)((function(){var e,t,r,i,o,l,u,d,m,f,h;return(0,x.__generator)(this,(function(x){switch(x.label){case 0:return e=Object.values(y).some((function(e){return e.import})),e?[3,1]:(window.alert("Please select at least one file column to import."),[3,6]);case 1:for(v(!0),t=[],r=Object.entries(y),i=0;i<r.length;i++)o=(0,p.Z)(r[i],2),l=o[0],(u=o[1]).import&&(d=n.generatePropertyKey(l),(m=u.name)&&0!==m.length||(m="(No Name)",w.Tb(new Error("Property with no Name"),{extra:{key:d,collectionId:n.id}})),f=new re.Z9({name:m,range:u.dataType,key:d,unique:u.unique,withIndex:u.withIndex},n.workspace,n.id),t.push(f),a(l,f));x.label=2;case 2:return x.trys.push([2,4,,5]),[4,n.createProperties(t,!0)];case 3:return x.sent(),[3,5];case 4:throw h=x.sent(),s&&s("Error while creating properties. Please try again or refresh the page."),v(!1),h;case 5:c(),x.label=6;case 6:return[2]}}))}))).apply(this,arguments)}return(0,r.jsxs)(be,{children:[(0,r.jsxs)("div",{className:"mt-4 text-center text",children:[(0,r.jsx)("div",{children:(0,r.jsx)("strong",{children:"Select the file columns you want to import and define your column data types."})}),(0,r.jsxs)("div",{children:['Click on the "Import?" column header to ',(0,r.jsx)("strong",{children:"select/unselect all."})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"d-flex listing-headers justify-content-between",children:[(0,r.jsx)("div",{className:"d-inline-flex flex-grow-1 mapping-column",children:"Name"}),(0,r.jsx)("div",{className:"d-inline-flex flex-0 mapping-column justify-content-end",style:{width:128},children:"Data Type"}),!1,(0,r.jsx)("div",{className:"d-inline-flex align-items-center flex-0 mapping-column justify-content-end",style:{width:96,paddingRight:16},children:(0,r.jsx)(ae.F,{actions:function(){return[{label:"Unselect all",action:je.R.UNSELECT_ALL,icon:(0,r.jsx)(P.gU9,{size:16}),type:oe.D$.NORMAL},{label:"Select all",action:je.R.SELECT_ALL,icon:(0,r.jsx)(P.X$5,{size:16,color:"green"}),type:oe.D$.NORMAL}]},onSelection:function(e){e===je.R.SELECT_ALL?b((function(e){var n=(0,d.Z)({},e);return Object.entries(n).forEach((function(e){var n=(0,p.Z)(e,2);n[0];n[1].import=!0})),n})):e===je.R.UNSELECT_ALL?b((function(e){var n=(0,d.Z)({},e);return Object.entries(n).forEach((function(e){var n=(0,p.Z)(e,2);n[0];n[1].import=!1})),n})):console.error("Unknown action")},align:"BOTTOM",placement:"bottom",children:(0,r.jsx)("div",{className:"d-inline-flex",children:(0,r.jsx)(ie.u,{content:"Click to 'Select' or 'Unselect' all",children:(0,r.jsx)("div",{className:"cursor-pointer",children:"Import?"})})})})})]}),(0,r.jsx)("div",{className:"d-flex flex-column justify-content-center align-items-center",children:t.map((function(e){return(0,r.jsx)(ve,{header:e,mapping:y[e.id],itemsPreviews:o,onChangeMapping:f},e.id)}))}),(0,r.jsx)("div",{className:"text-center mt-5 mb-5",children:g?(0,r.jsx)("span",{children:"Loading..."}):(0,r.jsxs)("button",{className:"btn btn-primary",onClick:function(){return N.apply(this,arguments)},children:[(0,r.jsx)("span",{children:"Continue"}),(0,r.jsx)(P.Rgz,{size:16})]})}),"\xa0"]})]})}var we=t(16705),Se=(t(90114),t(87204)),Ce=t(9511);function Ee(e){var n=e.collection,t=e.onNewProperty,i=e.itemsPreviews,o=e.headerName,a=function(e){c.modal.close(),t(e)},c=(0,s.QT)().uiStore,l=o;return(0,r.jsx)(ie.u,{content:"Create a new property",children:(0,r.jsx)("button",{className:"btn btn-light height-full",onClick:function(){var e=i.map((function(e){return e.data[o]}));c.modal.show((0,r.jsx)(ce.Z,{title:"Add new property",hideActions:!0,content:(0,r.jsx)(Ce.F,{collection:n,onNewProperty:a,nameSuggestion:l,rangeSuggestion:(0,se.kn)(e),hideBuiltInProperties:!0})}))},children:(0,r.jsx)(P.OvN,{size:16})})})}var Pe=t(80204),ke=t(40050);function Ie(){var e=(0,f.Z)(["\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n\n    border-top: 1px solid #F2F3F2;\n\n    .mapping-checkbox-outter {\n        padding: 15px 25px 15px 15px;\n    }\n\n    .csv-header {\n        width: 400px;\n\n        span {\n            font-weight: bold;\n        }\n    }\n\n    .property-mapping {\n        width: 500px;\n\n        .property-btn {\n            margin: 15px 5px;\n        }\n    }\n"]);return Ie=function(){return e},e}var Te=v.ZP.div(Ie());var Re=(0,a.Pi)((function(e){var n=e.collection,t=e.header,o=e.mappingProperty,a=e.itemsPreviews,s=e.properties,c=e.onChange,l=e.joinOnProperty,u=e.onJoinOnPropertyChange,d=(0,i.useState)(!1);d[0],d[1],(0,i.useEffect)((function(){"undefined"===typeof o&&s.forEach((function(e){(0,Z.T0)([t.id],[e.identifier,e.name])&&c(t.id,e)}))}),[t.id]);var m=o?o.identifier:"",p=!(!o||!o.unique);return(0,r.jsxs)(Te,{children:[!1,(0,r.jsx)("div",{className:"mapping-column csv-header",children:(0,r.jsx)("span",{children:t.name})}),(0,r.jsxs)("div",{className:"property-mapping d-flex",children:[(0,r.jsxs)("div",{className:"d-inline-flex flex-grow-1",children:[p&&(0,r.jsx)("div",{className:"d-inline-flex align-items-center mr-1",children:(0,r.jsx)(ie.u,{content:"This property has unique values",children:(0,r.jsx)("span",{className:"p-2",children:(0,r.jsx)(P.o1l,{size:16})})})}),(0,r.jsx)(Se.Z,{prefix:"mapping",identifier:t.id,value:m,propertiesList:s,onChange:function(e){if(0===e.target.selectedIndex)c(t.id,null);else{var n=e.target.value,r=s.find((function(e){return e.identifier===n}));r&&c(t.id,r)}}}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"d-inline-flex align-items-center ml-1 property-btn",children:(0,r.jsx)(Pe.Z,{property:o,collection:n})}),(0,r.jsx)(ke.Z,{enabled:o.identifier===l||o.isUnique,property:o,onToggle:o.isUnique?function(){alert("A property with a unique value option will be de facto used for the join.")}:function(e){l===e.identifier?u(null):u(e.identifier)}})]})]}),(0,r.jsx)("div",{className:"ml-1 d-inline-flex property-btn",children:(0,r.jsx)(Ee,{collection:n,onNewProperty:function(e){c(t.id,e,!0)},itemsPreviews:a,headerName:t.name})})]})]})})),Ze=t(45599);function Le(){var e=(0,f.Z)(["\n    max-width: 700px;\n    margin: 0 auto;\n\n    .listing-headers {\n        margin-bottom: 10px;\n        margin-top: 40px;\n        color: #00000080;\n    }\n"]);return Le=function(){return e},e}var Oe=v.ZP.div(Le());var Me=(0,a.Pi)((function(e){var n=e.collection,t=e.headers,i=e.properties,o=e.itemsPreviews,a=e.mappingSettings,s=e.onChange,c=e.onContinueToImport,l=e.joinOnProperty,u=e.onJoinOnPropertyChange,d=e.onCleanMappings;return(0,r.jsxs)(Oe,{children:[(0,r.jsxs)("div",{className:"mt-4 text-center text",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("strong",{children:["Map your file columns with existing collection properties or create new properties by clicking the ",(0,r.jsx)("span",{style:{color:"orange",fontSize:16},children:"+"})," button."]})}),(0,r.jsxs)("div",{children:['Click on the "Collection Property" column header to ',(0,r.jsx)("strong",{children:"remove auto mapping."})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"d-flex listing-headers justify-content-between",children:[!1,(0,r.jsx)("div",{className:"d-inline-flex mapping-column",style:{width:400},children:"File Column"}),(0,r.jsx)("div",{className:"d-inline-flex mapping-column",style:{width:500},children:(0,r.jsx)(ae.F,{actions:function(){return[{label:"Remove mappings",action:je.R.UNSELECT_ALL,icon:(0,r.jsx)(P.$Rx,{size:16}),type:oe.D$.NORMAL}]},onSelection:function(e){e===je.R.UNSELECT_ALL?d():console.error("Unknown action")},align:"BOTTOM",placement:"bottom",children:(0,r.jsx)("div",{className:"d-inline-flex",children:(0,r.jsx)(ie.u,{content:"Click to 'Select' or 'Unselect' all",children:(0,r.jsx)("div",{className:"cursor-pointer",children:"Collection Property"})})})})})]}),t.map((function(e){return(0,r.jsx)(Re,{collection:n,header:e,properties:i,itemsPreviews:o,mappingProperty:a[e.id],onChange:s,joinOnProperty:l,onJoinOnPropertyChange:u},e.id)}))]}),(0,r.jsx)("div",{className:"text-center mt-5",children:(0,r.jsxs)("button",{className:"btn btn-primary",onClick:function(){(0,we.xb)(a)?window.alert("Please select at least one file column to import."):c()},children:[(0,r.jsx)("span",{children:"Continue"}),(0,r.jsx)(P.Rgz,{size:16})]})}),(0,r.jsx)("div",{className:"mt-5",children:(0,r.jsx)(Ze.Z,{})})]})})),De=t(10320),ze=t(61515),_e=t(11198),Fe=t(20230),Ae=t(21555),Ue=t(86122),Be=t(97550),qe=t(82382),Je=t(65548);function We(){var e=(0,f.Z)(["\n    max-width: 800px;\n    margin: 0 auto;\n"]);return We=function(){return e},e}var Ve=v.ZP.div(We()),He=(0,i.forwardRef)((function(e,n){var o,a=e.headers,s=e.collection,c=e.rows,u=e.mappings,d=e.onDone,m=e.joinOnProperty,f=e.newProperties,h=e.importSourceName,g=e.numberItems,v=e.maxImportNumber,j=e.encoding,y=e.delimiter,b=e.skipFirstNLines,N=function(){var e={};return Object.entries(u).forEach((function(n){var t,r=(0,p.Z)(n,2),i=r[0],o=r[1];t=o?{identifier:o.identifier,dataType:o.dataType,primitiveDataType:o.primitiveDataType}:null,e[i]=t})),e},S=function(e){le(e)},C=(0,i.useRef)(null),E=(0,i.useRef)(null),P=(0,i.useRef)(null),k=(0,i.useState)(null),I=k[0],R=k[1],Z=(0,i.useState)(0),L=Z[0],O=Z[1],M=(0,i.useState)(0),D=M[0],z=M[1],_=(0,i.useState)([]),F=_[0],A=_[1],U=(0,i.useState)(null),B=U[0],q=U[1],J=(0,i.useState)(null),W=J[0],V=J[1],H=(0,i.useState)(1),G=H[0],K=H[1],Q=(0,i.useState)(0),$=Q[0],X=Q[1],Y=(0,i.useState)(0),ee=Y[0],ne=Y[1],te=(0,i.useState)([]),re=(te[0],te[1]),ie=(0,i.useState)([]),oe=ie[0],ae=ie[1],se=(0,i.useState)(ze.x9.MERGE_SOFT),ce=se[0],le=se[1],ue=(0,i.useState)(!0),de=ue[0],me=ue[1],pe=(0,i.useState)(ze.oD.FULL_OUTER_JOIN),fe=pe[0],he=pe[1];function xe(){return(xe=(0,l.Z)((function(){return(0,x.__generator)(this,(function(e){return C.current.postMessage({action:Ue.se.STOP_IMPORT}),[2]}))}))).apply(this,arguments)}function ge(){return ve.apply(this,arguments)}function ve(){return(ve=(0,l.Z)((function(){var e,t,r,i,o;return(0,x.__generator)(this,(function(c){switch(c.label){case 0:return K(3),q((new Date).getTime()),[4,s.getFirstItemRank()];case 1:return e=c.sent(),t=oe.map((function(e){return e.asJson})),m&&(i=s.properties.find((function(e){return e.identifier===m})))&&(r=i.asJson),o={workspaceId:s.workspace.id,collectionId:s.id,collectionDataType:s.itemsType,currentLexorankString:e.toString(),mergingMode:ce,uniquePropertiesJson:t,joinType:fe,joinOnPropertyJson:r,headers:a,maxImportNumber:v,mappings:N(),encoding:j,delimiter:y,skipFirstNLines:b},W&&(o.filterGroup=(0,De.xF)(W)),null!=n&&"function"!==typeof n&&(null===n||void 0===n?void 0:n.current)?o.file=n.current:o.fileItems=F,C.current.postMessage({action:Ue.se.IMPORT,params:o}),T.B({category:"Data",action:"Import",label:"PerformImport",value:g,data:{collectionId:s.id,numberItems:g,mergingMode:ce,uniqueProperties:oe.length,joinOnProperty:m}}),[2]}}))}))).apply(this,arguments)}function je(){return(je=(0,l.Z)((function(e){return(0,x.__generator)(this,(function(n){return e.preventDefault(),e.stopPropagation(),ge(),[2]}))}))).apply(this,arguments)}if(P.current={startingTime:B,itemsLength:g,mergingMode:ce,errorsCount:D,uniquePropertiesLength:oe.length},(0,i.useEffect)((function(){return C.current=new Worker(t.tu(new URL(t.p+t.u(4268),t.b))),C.current.onerror=function(e){R(Ae.n.WORKER_ERROR),w.Tb(e,{extra:{script:"ImportCSVScript"}})},C.current.onmessage=function(e){var n=e.data;if(n.action===Ue.kZ.MEMORY_ERROR)R(Ae.n.MEMORY_LIMIT),T.B({category:"Error",action:"MemoryError",label:"FileImportError"});else if(n.action===Ue.kZ.WORKER_ERROR)"performImport"===n.method?R(Ae.n.IMPORT_ERROR):"convertExternalData"===n.method?R(Ae.n.CONVERT_EXTERNAL_DATA_ERROR):R(Ae.n.OTHER_ERROR),w.Tb(new Error("Error in file import worker"),{extra:{method:n.method,exceptionName:n.exception.name,exceptionDescription:n.exception.description,stack:n.exception.stack}});else if(n.action===Ue.kZ.PREVIEW_UPDATES)O(n.processedCount),z(n.errorsCount);else if(n.action===Ue.kZ.PREVIEW_RESULTS)A(n.results.items),re(n.results.errors),K(2);else if(n.action===Ue.kZ.IMPORT_UPDATES)n.processedCountIncrease&&X((function(e){return e+n.processedCountIncrease})),n.importedCountIncrease&&ne((function(e){return e+n.importedCountIncrease}));else if(n.action===Ue.kZ.IMPORT_RESULTS){var t=n.results;s.initializeItems().then((function(){s.checkIsCollectionSyncable(!0).then((function(){d&&d(t)}))}));var r=0;if(P.current.startingTime)r=((new Date).getTime()-P.current.startingTime)/1e3;t.stopped&&T.B({category:"Data",action:"Import",label:"PerformImportStopped",value:Math.round(r),data:{collectionId:s.id,numberItems:P.current.itemsLength,mergingMode:P.current.mergingMode,duration:r,uniqueProperties:P.current.uniquePropertiesLength,errorsCount:P.current.errorsCount}}),T.B({category:"Data",action:"Import",label:"PerformImportDone",value:Math.round(r),data:{collectionId:s.id,numberItems:P.current.itemsLength,mergingMode:P.current.mergingMode,duration:r,uniqueProperties:P.current.uniquePropertiesLength,errorsCount:P.current.errorsCount}})}},C.current.postMessage({action:Ue.se.PREVIEW,params:{rows:c,headers:a,mappings:N()}}),function(){C.current&&C.current.terminate()}}),[u]),(0,i.useEffect)((function(){var e=0,n=[];Object.entries(u).forEach((function(t){var r=(0,p.Z)(t,2),i=(r[0],r[1]);i&&(e+=1,i.isUnique&&n.push(i))})),ae(n),m&&le(ze.x9.MERGE_HARD),me(f.length+1<e)}),[u]),1===G){var ye=Math.floor(L/c.length);o=(0,r.jsxs)("div",{className:"d-flex flex-column align-items-center",children:[(0,r.jsx)(Je.c,{size:30}),(0,r.jsxs)("div",{className:"text-bold pt-4",children:["Generating preview data (",ye,"%)"]})]})}else if(2===G){var be=W?"Process ".concat(g," items with filters"):"Import ".concat(g," items");o=(0,r.jsx)("button",{className:"btn btn-primary",type:"submit",children:be})}return(0,r.jsxs)(Ve,{children:[I&&(0,r.jsx)(Ae.Z,{errorKind:I}),3!==G?(0,r.jsxs)("div",{children:[(0,r.jsx)(_e.Z,{uniqueProperties:oe,mergingMode:ce,onMergingModeChange:S}),(0,r.jsx)(Fe.Z,{joinType:fe,joinOnProperty:m,collectionLabel:s.label,importSourceName:h,showMergingMode:de,onJoinTypeChange:function(e){he(e)},mergingMode:ce,onMergingModeChange:S}),2===G?(0,r.jsxs)("form",{onSubmit:function(e){return je.apply(this,arguments)},ref:E,children:[(0,r.jsx)(Be.Z,{collection:s,mappings:u,items:F,numberItems:g,filterGroup:W,handleFilterGroupChange:function(e){V(e)},enableFiltering:null!=n&&"function"!==typeof n&&!!(null===n||void 0===n?void 0:n.current)}),(0,r.jsx)("div",{className:"text-center mt-5 mb-5",children:o})]}):(0,r.jsx)("div",{className:"text-center mt-6 mb-5",children:o}),"\xa0"]}):(0,r.jsx)(r.Fragment,{children:!I&&(0,r.jsx)(qe.Z,{importedNumber:ee,processedNumber:$,numberItems:g,onStopImport:function(){return xe.apply(this,arguments)},withFiltering:!!W})})]})})),Ge=t(69232);function Ke(){var e=(0,f.Z)(["\n    padding: 50px;\n"]);return Ke=function(){return e},e}var Qe=v.ZP.div(Ke()),$e=(0,a.Pi)((function(e){var n,t,a=e.collection,c=function(){le({}),me("")},f=function(e,n,t){le((function(t){return(0,m.Z)((0,d.Z)({},t),(0,u.Z)({},e,n))})),n&&n.isUnique&&me(null),n&&t&&he((function(e){return(0,h.Z)(e).concat([n.identifier])}))},v=function(){R(4)},w=(0,i.useState)(!1),S=w[0],C=w[1],E=(0,s.QT)(),P=E.uiStore,k=E.authStore,I=(0,i.useState)(1),T=I[0],R=I[1],Z=(0,i.useState)(null),L=Z[0],O=Z[1],M=(0,i.useState)(!1),D=M[0],z=M[1],_=(0,i.useState)([]),F=_[0],A=_[1],U=(0,i.useState)([]),B=U[0],q=U[1],J=(0,i.useState)(""),W=J[0],V=J[1],H=(0,i.useState)(null),G=H[0],K=H[1],Q=(0,i.useState)(null),$=Q[0],X=Q[1],Y=(0,i.useState)(""),ee=Y[0],ne=Y[1],re=(0,i.useState)(0),ie=re[0],oe=re[1],ae=(0,i.useRef)(null),se=(0,i.useState)({}),ce=se[0],le=se[1],ue=(0,i.useState)(""),de=ue[0],me=ue[1],pe=(0,i.useState)([]),fe=pe[0],he=pe[1],xe=(0,o.useRouter)();if(function(e,n){var t=(0,o.useRouter)();(0,i.useEffect)((function(){var r=function(r){if(t.asPath!==r&&e&&!confirm(n))throw t.events.emit("routeChangeError"),t.push(t.asPath,void 0,{shallow:!0}),'RouteChangeCancelError - Route change to "'.concat(r,'" was aborted (this error can be safely ignored). See https://github.com/zeit/next.js/issues/2476.')};return t.events.on("routeChangeStart",r),function(){t.events.off("routeChangeStart",r)}}),[e])}(F.length>0&&1!==T&&5!==T,"Do you want to cancel your import?"),(0,i.useEffect)((function(){!function(){var e=(0,l.Z)((function(){return(0,x.__generator)(this,(function(e){switch(e.label){case 0:return a.hasProperties?[3,2]:[4,a.fetchProperties()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}));return function(){return e.apply(this,arguments)}}()()}),[a.id]),(0,i.useEffect)((function(){return P.increaseKeyboardShortcutsDisableCounter(),function(){P.decreaseKeyboardShortcutsDisableCounter()}}),[]),(0,i.useEffect)((function(){C(!0)}),[]),!S)return null;function ge(){return(ge=(0,l.Z)((function(e){return(0,x.__generator)(this,(function(n){switch(n.label){case 0:return[4,(0,g.gx)((function(){return a.isPropertyLoaded}))];case 1:return n.sent(),0===a.properties.length?R(2):R(3),z(e),[2]}}))}))).apply(this,arguments)}var ve,je=!1;if(k.isAnonymousUser)ve=(0,N.B5)(k.isAnonymousUser,null);else{var ye=k.isReady&&k.currentAccount.freePlan;ve=(0,N.B5)(!1,ye)}switch(T){case 1:n=(0,r.jsxs)("span",{children:["Import CSV/Excel to ",a.icon," ",(0,r.jsx)("strong",{children:a.label})]}),t=1;break;case 2:n="Customize your properties",t=2;break;case 3:n="Configure import",t=2;break;case 4:n="Review before import",t=3;break;case 5:je=!0}return(0,r.jsx)("div",{children:je?(0,r.jsx)(Ge.Z,{collection:a,results:L,fileName:W,anonymousTroncated:D,onNewImport:function(){R(1),O(null),z(!1),A([]),q([]),V(""),X(null),ne(""),K(null),oe(0),c(),he([]),ae.current=null},maxImportNumber:ve,isFreePlan:k.isReady&&!k.isAnonymousUser&&k.currentAccount.freePlan}):(0,r.jsxs)(b.Z,{onBack:function(){switch(T){case 1:xe.back();break;case 2:case 3:R(1);break;case 4:R(3)}},title:n,stepNumber:t,subTitle:W,numberSteps:3,children:[(0,r.jsx)("div",{className:1===T?"":"d-none",children:(0,r.jsx)(Qe,{children:(0,r.jsx)(te,{headers:F,onSetHeaders:function(e){(0,j.cM)(e),A(e)},onSetCsvData:function(e){q(e)},onContinueToMapping:function(e){return ge.apply(this,arguments)},onSetFileName:function(e){V(e)},collection:a,onIncrementNumberItems:function(e){K(null===e?0:function(n){return n+e})},onSetEncoding:function(e){X(e)},onSetDelimiter:function(e){ne(e)},maxImportNumber:ve,onSetSkipFirstNLines:function(e){oe(e)},encoding:$,delimiter:ee,numberItems:G,ref:ae})})}),2===T&&(0,r.jsx)("div",{children:(0,r.jsx)(Ne,{collection:a,headers:F,mappingSettings:ce,onChange:f,onError:function(e){P.setNotification({category:"error",message:e})},onContinueToImport:v,itemsPreviews:B.slice(0,100)})}),3===T&&(0,r.jsx)("div",{children:(0,r.jsx)(Me,{collection:a,headers:F,properties:a.editableOnCreationProperties,mappingSettings:ce,itemsPreviews:B.slice(0,100),onChange:f,onContinueToImport:v,joinOnProperty:de,onCleanMappings:c,onJoinOnPropertyChange:function(e){if(e){var n=!1;if(Object.entries(ce).forEach((function(e){var t=(0,p.Z)(e,2),r=(t[0],t[1]);r&&r.isUnique&&(n=!0)})),n)return void alert("Can't join when a property with unique option is already mapped.")}me(e)}})}),4===T&&(0,r.jsx)("div",{children:(0,r.jsx)(He,{collection:a,rows:B,headers:F,mappings:ce,joinOnProperty:de,newProperties:fe,importSourceName:W,onDone:function(e){if(O(e),R(5),a.label===y.Cw){var n=W.replace(/\.[^/.]+$/,"");a.setLabel(n)}a.checkItemsUpdates()},numberItems:G,encoding:$,delimiter:ee,skipFirstNLines:ie,maxImportNumber:ve,ref:ae})})]})})}));var Xe=(0,a.Pi)((function(){var e=(0,s.QT)(),n=e.dataSpaceStore,t=e.uiStore,a=e.authStore,l=(0,o.useRouter)(),u=l.query.collection;if((0,i.useEffect)((function(){u&&t.setCurrentPage("collection",String(u))}),[u]),!u)return null;if(!n.hasCurrentWorkspace)return null;if(n.currentWorkspace.isLoadingCollections)return null;var d=n.currentWorkspace.getCollection(String(u));return d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{collection:d}),(0,r.jsx)($e,{collection:d})]}):(a.isAnonymousUser?l.push("/home"):l.push("/getting-started"),null)}))},32807:function(){},88223:function(){}},function(e){e.O(0,[1778,2876,1010,74,1209,5204,5436,2845,9774,2888,179],(function(){return n=63708,e(e.s=n);var n}));var n=e.O();_N_E=n}]);
//# sourceMappingURL=https://app.datablist.com/static/chunks/import-0f776c27ec3602a4.js.map